<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>學生資料管理系統</title>
  <link rel="shortcut icon" href="#" type="image/x-icon">
  <link rel="stylesheet" href="style.css">
  <!-- 置入BS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css"
    integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
  <!---匯入要使用的函式庫--->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"
    integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

  <style>
    p {
      padding-left: 5px;
      font-size: 1.25rem;
    }

    form {
      display: flex;
      flex-direction: column;
      text-align: center;
    }

    form input {
      margin: 8px 0;
      border: 1px solid #D9D9D9;
      border-radius: 5px;
      padding: 8px;
      box-sizing: border-box;
      width: 30%;
      background-color: #FFF;
      font-size: 15px;
    }

    .p {
      display: flex;
      flex-direction: row;
      justify-content: center;
      text-align: center;
    }


    .display-4 {
      text-align: center;
    }
  </style>
</head>

<body>
  <!-- ---------------------------------------------------------------------------------- -->
  <!-- 標題 -->
  <div class="jumbotron">
    <h1 class="display-4">學生資料管理系統</h1>
    <hr>
    <div style="display:flex;justify-content: center;text-align: center; ">
      <div class="btn btn-info" onclick="loadForm('add')">新增學員</div>

      <!-- Modal -->
      <div class="modal fade" id="stuModal" tabindex="-1" aria-labelledby="stuModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <!-- <h5 class="modal-title" id="stuModalLabel">Modal title</h5> -->
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <div id="studentForm">
                <!-- Form表單改用檔案引入方式呈現 -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- ---------------------------------------------------------------------------------- -->
  <!-- 新增學生資料 -->
  <!-- <div class="btn btn-success" onclick="loadForm('add')">新增學員</div> -->
  <!-- <div id="studentForm"> -->
  <!-- Form表單改用檔案引入方式呈現 -->
  <!-- </div> -->
  <!-- ---------------------------------------------------------------------------------- -->
  <!-- 編輯學生資料 -->
  <!-- <div class="editForm"></div>
  <form method="post">
    <h3 class="text-white bg-secondary">編輯學員</h3>
    <p><input type="number" name="classroom" id="eClassroom"  value=""  placeholder="請輸入班級"></p>
    <p><input type="number" name="seatnum" id="eSeatnum"  value=""  placeholder="請輸入座號"></p>
    <p><input type="text" name="name" id="eName"  value=""  placeholder="請輸入姓名"></p> 
    <p><input type="date" name="birthday" id="eBirthday" value=""  ></p>
    <p>
      <input type="hidden" name="id" id="stuId" value="">
      <input type="button" value="確認編輯" onclick="update()" class="btn btn-info">
    </p>
    <p>
      <input type="reset" value="清除"  class="btn btn-danger">
    </p>
  </form> -->

  <!-- ---------------------------------------------------------------------------------- -->
  <!-- 班級選擇 -->
  <h3 class="text-white bg-secondary" style="display: flex; justify-content: center;">班級選擇</h3>
  <div class="p">

    <a href="JavaScript:query(101)" class="btn btn-outline-info">101</a>
    <a href="JavaScript:query(102)" class="btn btn-outline-info">102</a>
    <a href="JavaScript:query(103)" class="btn btn-outline-info">103</a>
    <a href="JavaScript:query(104)" class="btn btn-outline-info">104</a>
    <a href="JavaScript:query(105)" class="btn btn-outline-info">105</a>
    <a href="JavaScript:query(106)" class="btn btn-outline-info">106</a>
    <a href="JavaScript:query(107)" class="btn btn-outline-info">107</a>
    <a href="JavaScript:query(108)" class="btn btn-outline-info">108</a>
    <a href="JavaScript:query(109)" class="btn btn-outline-info">109</a>
    <a href="JavaScript:query(110)" class="btn btn-outline-info">110</a>

    <div id="result" style="display:none;font-size: 1.25rem;"></div>
  </div>
  <!-- ---------------------------------------------------------------------------------- -->
  <br>
  <hr>
  <br>
  <!-- ---------------------------------------------------------------------------------- -->
  <!-- 班級資料內容 -->
  <div class="container">
    <!-- <div class="row"> -->
    <h3 id="room" class="text-info"></h3>
    <div id="list" class="row">
    </div>
    <!-- </div> -->
  </div>
  <!-- ---------------------------------------------------------------------------------- -->
  <!-- 置入JQ & JS -->
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js"
    integrity="sha384-VHvPCCyXqtD5DqJeNxl2dtTyhF78xXNXdkwX1CZeRusQfRKp+tA7hAShOK/B/fQ2"
    crossorigin="anonymous"></script>

</body>

</html>
<script>
  /************************************
  * 1.考慮觸發行為的事件
  * 2.建立監聽行為
  * 3.考慮是否需要代入參數
  * 4.是否會有回傳值？回傳值的功用及處理？
  * 5.是否需要更新畫面內容？更新畫面的方法？
  ************************************/
  query(101);
  /*--------------------------------------------------------------------------*/
  function loadForm(type) {
    $(".modal-body").load("./form/student_form.php", { type }, () => {
      $("#stuModal").modal('show');
    })
  }
  /*--------------------------------------------------------------------------*/
  //新增資料的函式
  function create() {
    let form = {
      "classroom": $("#classroom").val(),
      "seatnum": $("#seatnum").val(),
      "name": $("#name").val(),
      "birthday": $("#birthday").val()
    }
    // console.log(form);
    $.post("./api/insert.php", form, (res) => {
      if (parseInt(res) === 1) {
        alert('新增成功')

        $("#classroom").val(""),
          $("#seatnum").val(""),
          $("#name").val(""),
          $("#birthday").val("")

        query(form.classroom)
      } else {
        alert('新增失敗')
      }
      $(".modal-body").html('');
      $("#stuModal").modal('hide');
      // console.log(res);
    })
  }
  /*--------------------------------------------------------------------------*/
  //查詢資料的函式
  function query(classroom) {
    $("#room").html(`現在顯示的是${classroom}班級的學生`)
    $.get("api/query.php", { classroom }, (students) => {
      students = JSON.parse(students)

      let tr = "";
      // console.log(students)
      students.forEach((val, idx) => {
        // console.log(idx,val)
        tr = tr +
          `<div class="card border-secondary mb-3">
            <div class="card-body">
              <div class="card-text">${val.name}</div>
              <hr>
              <div class="card-text">${val.birthday}</div>
              <hr>
                <button class="btn btn-success" onclick='edit(${val.id})'><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16">
    <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
    <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/>
  </svg></button>
                <button class="btn btn-danger" onclick='del(${classroom},${val.id})'><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash3-fill" viewBox="0 0 16 16">
    <path d="M11 1.5v1h3.5a.5.5 0 0 1 0 1h-.538l-.853 10.66A2 2 0 0 1 11.115 16h-6.23a2 2 0 0 1-1.994-1.84L2.038 3.5H1.5a.5.5 0 0 1 0-1H5v-1A1.5 1.5 0 0 1 6.5 0h3A1.5 1.5 0 0 1 11 1.5Zm-5 0v1h4v-1a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5ZM4.5 5.029l.5 8.5a.5.5 0 1 0 .998-.06l-.5-8.5a.5.5 0 1 0-.998.06Zm6.53-.528a.5.5 0 0 0-.528.47l-.5 8.5a.5.5 0 0 0 .998.058l.5-8.5a.5.5 0 0 0-.47-.528ZM8 4.5a.5.5 0 0 0-.5.5v8.5a.5.5 0 0 0 1 0V5a.5.5 0 0 0-.5-.5Z"/>
  </svg></button>
            </div>
          </div>`
          ;
      })
      $("#list").html(tr);
    })
  }
  /*--------------------------------------------------------------------------*/
  // 取得要修改的學生資料
  function edit(id) {
    // loadForm('edit');

    //   $.get("./api/show.php",{id},(student)=>{
    //     student=JSON.parse(student)
    //     $("#classroom").val(student.classroom)
    //     $("#seatnum").val(student.seat_num)
    //     $("#name").val(student.name)
    //     $("#birthday").val(student.birthday)
    //     $("#stuId").val(student.id)
    //   })
    $(".modal-body").load("./form/student_form.php", { type: 'edit' }, () => {
      $.get("./api/show.php", { id }, (student) => {
        student = JSON.parse(student)
        //console.log(student)
        $("#classroom").val(student.classroom)
        $("#seatnum").val(student.seat_num)
        $("#name").val(student.name)
        $("#birthday").val(student.birthday)
        $("#stuId").val(student.id)

        $("#stuModal").modal('show')
      })

    })

  }
  /*--------------------------------------------------------------------------*/
  //編輯資料的函式
  function update() {
    let form = {
      "classroom": $("#classroom").val(),
      "seatnum": $("#seatnum").val(),
      "name": $("#name").val(),
      "birthday": $("#birthday").val(),
      "id": $("#stuId").val()
    }
    // console.log(form)
    $.post("./api/update.php", form, () => {
      $("#classroom").val(""),
        $("#seatnum").val(""),
        $("#name").val(""),
        $("#birthday").val(""),
        $("#stuId").val("")

      query(form.classroom)

      $(".modal-body").html('');
      $("#stuModal").modal('hide');
    })
  }
  /*--------------------------------------------------------------------------*/
  //刪除資料的函式
  function del(classroom, id) {

    $.post("./api/delete.php", { id }, (res) => {

      if (parseInt(res) === 1) {
        $("#result").css({ color: 'green', display: 'block' }).text("刪除成功")
      } else {
        $("#result").css({ color: 'tomato', display: 'block' }).text("刪除失敗")
      }

      query(classroom);

      setTimeout(() => {
        $("#result").hide();
      }, 3000);
    })

  }
/*--------------------------------------------------------------------------*/
</script>